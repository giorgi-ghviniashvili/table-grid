!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-selection"),require("d3-array")):"function"==typeof define&&define.amd?define(["exports","d3-selection","d3-array"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).d3Table={},t.d3,t.d3)}(this,(function(t,e,s){"use strict";class i{constructor(t,e=10){this.all_data=t.slice(),this.filtered_data=t.slice(),this.rows_shown=e,this.page_size=e}filter(t){return this.filtered_data=this.all_data.filter(t||(()=>!0)),this.currentData}sort(t){return this.filtered_data.sort(((e,s)=>t(e,s))),this.currentData}nextPage(){return this.rows_shown+=this.page_size,this.currentData}collapse(){return this.rows_shown=this.page_size,this.currentData}set pageSize(t){this.page_size=t,this.rows_shown=t}get currentData(){return this.filtered_data.slice(0,this.rows_shown)}get onlyOnePage(){return this.filtered_data<=this.page_size}}const a={selection:e.selection,select:e.select,groups:s.groups},l=()=>{const t=window.innerWidth;return t<=576?"xs":t<=768?"sm":t<=992?"md":t<=1200?"lg":"rest"};const n={selection:e.selection,select:e.select,groups:s.groups,sum:s.sum};t.DataStore=i,t.Table=function(t){a.selection.prototype.patternify=function(t){var e=this,s=t.selector,i=t.tag,a=t.data||[s],l=e.selectAll("."+s).data(a,((t,e)=>"object"==typeof t&&t.id?t.id:e));return l.exit().remove(),(l=l.enter().append(i).merge(l)).attr("class",s),l};const e=Object.assign({id:Math.floor(1e7*Math.random()),container:"body",data:[],headers:[],cellHeight:60,firstColumnWidth:{xs:140,sm:130,md:145,lg:160,rest:175},pageSize:{xs:6,sm:10,md:10,lg:10,rest:12},numOfColumnsMobile:{xs:2,sm:3,md:8,lg:10,rest:12},mobileBreakdown:"xs",pagination:!0,sortable:!0,responsive:!0},t);let s,n,o,r,h,d,c,p,u,g,y,f,m,w=e.headers,b=null,v=2,x=null;const H=(t,e)=>{let s=e;return"function"==typeof e&&(s=e(t)),t[s]};function S(){M(),s=new i(e.data,m),h=a.select(e.container),x=w.find((t=>t.order)),b=a.groups(w.filter((t=>t.category)),(t=>t.category)).map(((t,e)=>({title:t[0],headers:t[1].length,isMainColumn:t[1][0].isMainColumn}))),d=h.patternify({tag:"div",selector:"table-grid"}),c=d.patternify({tag:"div",selector:"table-categories"}),p=d.patternify({tag:"div",selector:"table-header"}),g=d.patternify({tag:"div",selector:"table-body"}).style("position","relative"),T()}function M(){const t=l();e.responsive&&!e.pagination&&(e.responsive=!1),m=e.pagination?e.pageSize[t]:e.data.length+1,v=e.numOfColumnsMobile[t],f=e.firstColumnWidth[t],s&&(s.pageSize=m)}function T(t){e.pagination?(n=h.patternify({tag:"button",selector:"show-btn"}).attr("class","show-btn btn").text("SHOW MORE").on("click",(function(){s.currentData.length>=s.filtered_data.length?(s.collapse(),W(),z(),x&&e.sortable&&_(x,!1)):(s.nextPage(),W(),z(),x&&e.sortable&&_(x,!1))})),W()):h.selectAll(".show-btn").remove(),d.classed("v-scrollable",e.responsive),g.classed("h-scrollable",!e.pagination),b.length&&function(){b.some((t=>t.isMainColumn))||b.unshift({title:"main",headers:1,isMainColumn:!0,hidden:!0});c.patternify({tag:"div",selector:"category-title",data:b}).html((t=>t.title)).classed("main-column",(t=>t.isMainColumn)).style("width",(t=>t.isMainColumn?`${f}px`:`calc(((100% - ${f}px) / ${w.length-1}) * ${t.headers})`)).style("visibility",(t=>t.hidden?"hidden":null)).patternify({tag:"div",selector:"cat-border"})}(),function(t){y=p.patternify({tag:"div",selector:"table-head",data:w}).attr("class",((t,e)=>"table-head"+(t.isMainColumn?" main-column":"")+(t.class?" "+t.class:""))).style("width",B),y.each((function(e){t&&e.isMainColumn||(e.headerTemplate&&"function"==typeof e.headerTemplate?e.headerTemplate(e).then((t=>{a.select(this).html(t)})):a.select(this).html(e.name))})),y.filter((t=>t.sort)).on("click",((t,e)=>{"asc"==e.order?e.order="desc":e.order="asc",_(e)}))}(t),C(),e.pagination&&O(),e.responsive&&R(),e.sortable&&x&&_(x,!1)}function C(){u=g.patternify({tag:"div",selector:"table-row",data:s.currentData}).style("left","0px").style("top",(function(t,s){return s*e.cellHeight+"px"})),u.each((function(t,s){const i=a.select(this).patternify({tag:"div",selector:"table-data",data:w}).attr("class",(t=>"table-data"+(t.isMainColumn?" main-column":" value-column")+(t.class?" "+t.class:""))).style("width",B).style("height",e.cellHeight+"px");i.patternify({tag:"div",selector:"table-data-inner",data:t=>[t]}).html((e=>e.cellTemplate&&"function"==typeof e.cellTemplate?e.cellTemplate({...t,value:H(t,e.propName)}):H(t,e.propName)))}))}function _(t,s=!0){t.sort&&(y.filter((t=>t.sort)).each((function(e){const s=a.select(this);e.id===t.id?(s.classed("active",!0),s.classed("asc"===e.order?"desc":"asc",!1),s.classed(e.order,!0)):(e.order=null,s.classed("active",!1),s.classed("desc",!1),s.classed("asc",!1))})),u.sort(((e,s)=>t.sort(e,s,t.order))).transition().duration(s?1e3:0).style("top",((t,s)=>s*e.cellHeight+"px")),x=t)}function B(t){return t.isMainColumn?f+"px":`calc((100% - ${f}px) / ${w.length-1})`}function O(){const t=p.node().getBoundingClientRect().height;d.style("height",t+22+e.cellHeight*s.currentData.length+"px")}function R(){r=h.node().getBoundingClientRect().width,o=(r-f)/v;const t=Math.max(r,o*(w.length-1)+f);l()===e.mobileBreakdown&&t>r?(g.style("position","static"),d.classed("responsive",!0),u.style("width",t-f+"px").style("position","static"),c.style("width",t-f+"px"),c.selectAll(".category-title").style("width",((t,e)=>t.isMainColumn?f+"px":`calc((100% / ${w.length-1}) * ${t.headers})`)),p.style("width",t-f+"px"),d.selectAll(".main-column").style("position","absolute").style("margin-left",-f+"px"),d.style("margin-left",f+"px"),d.selectAll(".value-column").style("width",`calc(100% / ${w.length-1})`),d.selectAll(".table-head").style("width",((t,e)=>t.isMainColumn?f+"px":`calc(100% / ${w.length-1})`))):(d.classed("responsive",!1),d.selectAll(".main-column").style("position",null).style("margin-left",null),d.selectAll(".table-head").style("width",B),d.selectAll(".table-data").style("width",B).style("height",e.cellHeight+"px"),g.style("position","relative"),d.style("margin-left",null),u.style("width",null).style("margin-left",null).style("position",null),p.style("width",null).style("margin-left",null),c.style("width",null),c.selectAll(".category-title").style("width",(t=>t.isMainColumn?`${f}px`:`calc(((100% - ${f}px) / ${w.length-1}) * ${t.headers})`)))}function W(){s.onlyOnePage?n.style("display","none"):(n.style("display",null),s.currentData.length>=s.filtered_data.length?n.text("SHOW LESS"):n.text("SHOW MORE"))}function z(){d.classed("v-scrollable",e.responsive),g.classed("h-scrollable",!e.pagination),C(),e.pagination&&O(),e.responsive&&R()}return S.filter=function(t){s.filter(t),W(),C(),e.pagination&&O(),x&&e.sortable&&_(x,!1)},S.render=function(){S();let t=window.innerWidth;return a.select(window).on("resize."+e.id,(function(){t!==window.innerWidth&&(M(),T(!0)),t=window.innerWidth})),S},S},t.TableCompact=class{constructor(t){this.init_patternify(),this.attrs=Object.assign({id:Math.floor(1e7*Math.random()),container:"body",data:[],headers:[],cellHeight:48,rowsOnPage:10,pagination:!0,sortable:!0,rowGap:4,onResize:()=>{},rowTooltip:()=>{},onRowClick:()=>{}},t),this.transitionDuration=1e3,this.headers=this.attrs.headers,this.main(),this.setResizeHandler()}main(){const{attrs:t,headers:e}=this;this.setDimensions(),this.store=new i(t.data,this.pageSize),this.container=n.select(t.container),this.currentSort=e.find((t=>t.order)),this.table=this.container.patternify({tag:"div",selector:"table-grid"}),this.tableHeader=this.table.patternify({tag:"div",selector:"table-header"}),this.tBody=this.table.patternify({tag:"div",selector:"table-body"}).style("position","relative").style("overflow-y",t.pagination?"visible":null),this.drawAll()}drawAll(t){const{attrs:e,container:s}=this;this.sumOfRatios=n.sum(this.headers,(t=>t.widthRatio||1)),e.pagination?(this.showMoreOrLessBtn=s.patternify({tag:"button",selector:"show-btn"}).attr("class","show-btn btn").text("SHOW MORE").on("click",(()=>{this.store.currentData.length>=this.store.filtered_data.length?this.collapse():this.showMore()})),this.adjustShowBtn()):s.selectAll(".show-btn").remove(),this.addTableHead(t),this.addTableBody(),e.pagination&&this.adjustHeight(),e.sortable&&this.currentSort&&this.sortTableBy(this.currentSort,!1)}addTableHead(t){this.tableHeadCells=this.tableHeader.patternify({tag:"div",selector:"table-head",data:this.headers}).attr("class",((t,e)=>"table-head"+(t.isMainColumn?" main-column":"")+(t.class?" "+t.class:""))),this.tableHeadCells.style("width",(t=>this.getWidth(t))),this.tableHeadCells.each((function(e){if(!t||!e.isMainColumn){if(e.headerTemplate&&"function"==typeof e.headerTemplate){const t=e.headerTemplate(e);t.then?t.then((t=>{n.select(this).html(t)})):n.select(this).html(t)}else n.select(this).html(e.name);if(e.tooltip){this._tippy&&this._tippy.destroy();const t="function"==typeof e.tooltip?e.tooltip(e):e.tooltip;tippy(this,{theme:"light",content:t,arrow:!0,allowHTML:!0,maxWidth:220,placement:"top",onShow:()=>window.innerWidth>576})}}})),this.tableHeadCells.filter((t=>t.sort)).on("click",((t,e)=>{this.attrs.sortable&&("asc"==e.order?e.order="desc":e.order="asc",this.sortTableBy(e))}))}addTableBody(){const{headers:t,attrs:e}=this,s=this,i=this.tBody.patternify({tag:"div",selector:"table-row",data:this.store.currentData}).style("left","0px").style("top",((t,s)=>s*(e.cellHeight+e.rowGap)+"px")).on("click",((t,s)=>{window.innerWidth<=576&&(i.classed("highlighted",!1),n.select(t.target).classed("highlighted",!0),e.onRowClick(s))}));i.each((function(a,l){const o=n.select(this),r=o.patternify({tag:"div",selector:"table-data",data:t}).attr("class",(t=>"table-data"+(t.isMainColumn?" main-column":" value-column")+(t.class?" "+t.class:""))).style("width",(t=>s.getWidth(t))).style("height",e.cellHeight+"px");r.patternify({tag:"div",selector:"table-data-inner",data:t=>[t]}).html((t=>t.cellTemplate&&"function"==typeof t.cellTemplate?t.cellTemplate({...a,value:s.getValue(a,t.propName)},t):s.getValue(a,t.propName)));const h=e.rowTooltip(a);this._tippy&&this._tippy.destroy(),tippy(this,{theme:"light",content:h,arrow:!0,allowHTML:!0,maxWidth:350,trigger:"click",placement:"right",zIndex:999999,offset:[0,-318],onHide:()=>i.classed("highlighted",!1),onShow:()=>window.innerWidth>576&&(o.classed("highlighted",!0),!0)})})),this.tableRow=i}sortTableBy(t,e=!0){t.sort&&(this.tableHeadCells.filter((t=>t.sort)).each((function(e){const s=n.select(this);e.id===t.id?(s.classed("active",!0),s.classed("asc"===e.order?"desc":"asc",!1),s.classed(e.order,!0)):(e.order=null,s.classed("active",!1),s.classed("desc",!1),s.classed("asc",!1))})),this.tableRow.sort(((e,s)=>t.sort(e,s,t.order))).transition().duration(e?this.transitionDuration:0).style("top",((t,e)=>e*(this.attrs.cellHeight+this.attrs.rowGap)+"px")),this.currentSort=t)}getValue(t,e){let s=e;return"function"==typeof e&&(s=e(t)),t[s]}setDimensions(){this.pageSize=this.attrs.pagination?this.attrs.rowsOnPage:this.attrs.data.length+1,this.store&&(this.store.pageSize=this.pageSize)}getWidth(t){return 100*((t.widthRatio||1)/this.sumOfRatios)+"%"}adjustHeight(){const t=this.tableHeader.node().getBoundingClientRect().height+(this.attrs.cellHeight+this.attrs.rowGap)*this.store.currentData.length;this.table.style("height",t+"px"),this.tBody.style("height",t+"px")}adjustShowBtn(){const{showMoreOrLessBtn:t,store:e}=this;e.onlyOnePage?t.style("display","none"):(t.style("display",null),e.currentData.length>=e.filtered_data.length?t.text("SHOW LESS"):t.text("SHOW MORE"))}updateRows(){this.addTableBody(),this.attrs.pagination&&this.adjustHeight()}showMore(){this.store.nextPage(),this.adjustShowBtn(),this.updateRows(),this.currentSort&&this.attrs.sortable&&this.sortTableBy(this.currentSort,!1)}collapse(){this.store.collapse(),this.adjustShowBtn(),this.updateRows(),this.currentSort&&this.attrs.sortable&&this.sortTableBy(this.currentSort,!1)}filter(t){this.store.filter(t),this.adjustShowBtn(),this.addTableBody(),this.attrs.pagination&&this.adjustHeight(),this.currentSort&&this.attrs.sortable&&this.sortTableBy(this.currentSort,!1)}showColumns(t){this.headers=t,this.drawAll()}unhighlight(){this.tableRow.classed("highlighted",!1)}setResizeHandler(){let t=window.innerWidth;n.select(window).on("resize."+this.attrs.id,(()=>{t!==window.innerWidth&&(this.setDimensions(),this.drawAll(!0),this.attrs.onResize()),t=window.innerWidth}))}init_patternify(){n.selection.prototype.patternify=function(t){var e=t.selector,s=t.tag,i=t.data||[e],a=this.selectAll("."+e).data(i,((t,e)=>"object"==typeof t&&t.id?t.id:e));return a.exit().remove(),(a=a.enter().append(s).merge(a)).attr("class",e),a}}}}));
//# sourceMappingURL=table-grid.min.js.map
