!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3-selection"),require("d3-array")):"function"==typeof define&&define.amd?define(["exports","d3-selection","d3-array"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).d3Table={},e.d3,e.d3)}(this,(function(e,t,l){"use strict";class n{constructor(e,t=10){this.all_data=e.slice(),this.filtered_data=e.slice(),this.rows_shown=t,this.page_size=t}filter(e){return this.filtered_data=this.all_data.filter(e||(()=>!0)),this.currentData}sort(e){return this.filtered_data.sort(((t,l)=>e(t,l))),this.currentData}nextPage(){return this.rows_shown+=this.page_size,this.currentData}collapse(){return this.rows_shown=this.page_size,this.currentData}set pageSize(e){this.page_size=e,this.rows_shown=e}get currentData(){return this.filtered_data.slice(0,this.rows_shown)}get onlyOnePage(){return this.filtered_data<=this.page_size}}const i={selection:t.selection,select:t.select,groups:l.groups},s=()=>{const e=window.innerWidth;return e<=576?"xs":e<=768?"sm":e<=992?"md":e<=1200?"lg":"rest"};e.DataStore=n,e.Table=function(e){i.selection.prototype.patternify=function(e){var t=this,l=e.selector,n=e.tag,i=e.data||[l],s=t.selectAll("."+l).data(i,((e,t)=>"object"==typeof e&&e.id?e.id:t));return s.exit().remove(),(s=s.enter().append(n).merge(s)).attr("class",l),s};const t=Object.assign({id:Math.floor(1e7*Math.random()),container:"body",data:[],headers:[],cellHeight:60,firstColumnWidth:{xs:140,sm:130,md:145,lg:160,rest:175},pageSize:{xs:6,sm:10,md:10,lg:10,rest:12},numOfColumnsMobile:{xs:2,sm:3,md:8,lg:10,rest:12},mobileBreakdown:"xs",pagination:!0,sortable:!0,responsive:!0},e);let l,a,o,r,c,d,h,u,p,g,f,y,m,b=t.headers,w=null,x=2,v=null;const M=(e,t)=>{let l=t;return"function"==typeof t&&(l=t(e)),e[l]};function C(){_(),l=new n(t.data,m),c=i.select(t.container),v=b.find((e=>e.order)),w=i.groups(b.filter((e=>e.category)),(e=>e.category)).map(((e,t)=>({title:e[0],headers:e[1].length,isMainColumn:e[1][0].isMainColumn}))),d=c.patternify({tag:"div",selector:"table-grid"}),h=d.patternify({tag:"div",selector:"table-categories"}),u=d.patternify({tag:"div",selector:"table-header"}),g=d.patternify({tag:"div",selector:"table-body"}).style("position","relative"),$()}function _(){const e=s();t.responsive&&!t.pagination&&(t.responsive=!1),m=t.pagination?t.pageSize[e]:t.data.length+1,x=t.numOfColumnsMobile[e],y=t.firstColumnWidth[e],l&&(l.pageSize=m)}function $(e){t.pagination?(a=c.patternify({tag:"button",selector:"show-btn"}).attr("class","show-btn btn").text("SHOW MORE").on("click",(function(){l.currentData.length>=l.filtered_data.length?(l.collapse(),T(),H(),v&&t.sortable&&A(v,!1)):(l.nextPage(),T(),H(),v&&t.sortable&&A(v,!1))})),T()):c.selectAll(".show-btn").remove(),d.classed("v-scrollable",t.responsive),g.classed("h-scrollable",!t.pagination),w.length&&function(){w.some((e=>e.isMainColumn))||w.unshift({title:"main",headers:1,isMainColumn:!0,hidden:!0});h.patternify({tag:"div",selector:"category-title",data:w}).html((e=>e.title)).classed("main-column",(e=>e.isMainColumn)).style("width",(e=>e.isMainColumn?`${y}px`:`calc(((100% - ${y}px) / ${b.length-1}) * ${e.headers})`)).style("visibility",(e=>e.hidden?"hidden":null)).patternify({tag:"div",selector:"cat-border"})}(),function(e){f=u.patternify({tag:"div",selector:"table-head",data:b}).attr("class",((e,t)=>"table-head"+(e.isMainColumn?" main-column":"")+(e.class?" "+e.class:""))).style("width",D),f.each((function(t){e&&t.isMainColumn||(t.headerTemplate&&"function"==typeof t.headerTemplate?t.headerTemplate(t).then((e=>{i.select(this).html(e)})):i.select(this).html(t.name))})),f.filter((e=>e.sort)).on("click",((e,t)=>{"asc"==t.order?t.order="desc":t.order="asc",A(t)}))}(e),z(),t.pagination&&O(),t.responsive&&S(),t.sortable&&v&&A(v,!1)}function z(){p=g.patternify({tag:"div",selector:"table-row",data:l.currentData}).style("left","0px").style("top",(function(e,l){return l*t.cellHeight+"px"})),p.each((function(e,l){i.select(this).patternify({tag:"div",selector:"table-data",data:b}).attr("class",(e=>"table-data"+(e.isMainColumn?" main-column":" value-column")+(e.class?" "+e.class:""))).style("width",D).style("height",t.cellHeight+"px").patternify({tag:"div",selector:"table-data-inner",data:e=>[e]}).html((t=>t.cellTemplate&&"function"==typeof t.cellTemplate?t.cellTemplate({...e,value:M(e,t.propName)}):M(e,t.propName)))}))}function A(e,l=!0){e.sort&&(f.filter((e=>e.sort)).each((function(t){const l=i.select(this);t.id===e.id?(l.classed("active",!0),l.classed("asc"===t.order?"desc":"asc",!1),l.classed(t.order,!0)):(t.order=null,l.classed("active",!1),l.classed("desc",!1),l.classed("asc",!1))})),p.sort(((t,l)=>e.sort(t,l,e.order))).transition().duration(l?1e3:0).style("top",((e,l)=>l*t.cellHeight+"px")),v=e)}function D(e){return e.isMainColumn?y+"px":`calc((100% - ${y}px) / ${b.length-1})`}function O(){const e=u.node().getBoundingClientRect().height;d.style("height",e+22+t.cellHeight*l.currentData.length+"px")}function S(){r=c.node().getBoundingClientRect().width,o=(r-y)/x;const e=Math.max(r,o*(b.length-1)+y);s()===t.mobileBreakdown&&e>r?(g.style("position","static"),d.classed("responsive",!0),p.style("width",e-y+"px").style("position","static"),h.style("width",e-y+"px"),h.selectAll(".category-title").style("width",((e,t)=>e.isMainColumn?y+"px":`calc((100% / ${b.length-1}) * ${e.headers})`)),u.style("width",e-y+"px"),d.selectAll(".main-column").style("position","absolute").style("margin-left",-y+"px"),d.style("margin-left",y+"px"),d.selectAll(".value-column").style("width",`calc(100% / ${b.length-1})`),d.selectAll(".table-head").style("width",((e,t)=>e.isMainColumn?y+"px":`calc(100% / ${b.length-1})`))):(d.classed("responsive",!1),d.selectAll(".main-column").style("position",null).style("margin-left",null),d.selectAll(".table-head").style("width",D),d.selectAll(".table-data").style("width",D).style("height",t.cellHeight+"px"),g.style("position","relative"),d.style("margin-left",null),p.style("width",null).style("margin-left",null).style("position",null),u.style("width",null).style("margin-left",null),h.style("width",null),h.selectAll(".category-title").style("width",(e=>e.isMainColumn?`${y}px`:`calc(((100% - ${y}px) / ${b.length-1}) * ${e.headers})`)))}function T(){l.onlyOnePage?a.style("display","none"):(a.style("display",null),l.currentData.length>=l.filtered_data.length?a.text("SHOW LESS"):a.text("SHOW MORE"))}function H(){d.classed("v-scrollable",t.responsive),g.classed("h-scrollable",!t.pagination),z(),t.pagination&&O(),t.responsive&&S()}return C.filter=function(e){l.filter(e),T(),z(),t.pagination&&O(),v&&t.sortable&&A(v,!1)},C.render=function(){C();let e=window.innerWidth;return i.select(window).on("resize."+t.id,(function(){e!==window.innerWidth&&(_(),$(!0)),e=window.innerWidth})),C},C}}));
//# sourceMappingURL=table-grid.min.js.map
